import{j as e,B as j,C as I,r as c,k as E}from"./index-ace63820.js";import{M as T}from"./MainLayout-7c83bf1d.js";import{B as M}from"./BoardNavigation-69bd797e.js";import{u as b,S as D,I as W,a as v,b as z,G as L,C as R,M as G,c as N,D as $,O as V,d as q,e as Q,A as U}from"./ActionButtons-1da4b039.js";import{T as g,c as Y}from"./Logo-f0d95306.js";import{D as Z,C as H,a as J}from"./CloseButton-3039b10e.js";import{u as K}from"./formik.esm-5da2c63d.js";import{D as X}from"./DialogTitle-61ad983f.js";import{I as _}from"./IconButton-3d8c7b71.js";import{G as n}from"./Grid-013bcda4.js";import"./Avatar-10971abc.js";const ee="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",te=({value:t,size:i=100,...s})=>e.jsxs(j,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(I,{variant:"determinate",value:100,size:i,sx:{color:"#5E5F7D",...s.sx}}),e.jsx(I,{variant:"determinate",value:t,size:i,sx:{position:"absolute",left:0,...s.sx}}),e.jsx(j,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(t)}%`})})]}),se="/OnTrack.Frontend.React/assets/SearchIcon-bdadde32.svg";function B({isOpen:t,handleClose:i,project:s,mode:u}){const{addProject:r,updateProject:x}=b(),o=K({initialValues:{title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",memberIds:["8ea90da1-7a64-4817-9208-45b5ad734bc3"]},onSubmit:async(m,{setSubmitting:h})=>{const l={...s,title:m.title,description:m.description,memberIds:["8ea90da1-7a64-4817-9208-45b5ad734bc3"]};try{u==="add"?(await r(l),console.log("Adding project:",l)):u==="edit"&&(s!=null&&s.id)&&(console.log("Project updated:",l),await x(s.id,l)),i()}catch(p){console.error("Error submitting the project:",p)}finally{h(!1)}},enableReinitialize:!0});return e.jsxs(Z,{fullWidth:!0,maxWidth:"md",open:t,onClose:i,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(X,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:u==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(H,{onClick:i,right:20,top:20}),e.jsxs("form",{onSubmit:o.handleSubmit,children:[e.jsxs(J,{sx:{paddingBottom:12},children:[e.jsx(g,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(D,{fullWidth:!0,variant:"filled",name:"title",value:o.values.title,onChange:o.handleChange,placeholder:"Wpisz nazwe projektu",sx:{width:300}}),e.jsx(g,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(D,{fullWidth:!0,variant:"filled",name:"memberIds",value:o.values.memberIds,onChange:o.handleChange,placeholder:"Wyszukaj członków",sx:{width:300},InputProps:{endAdornment:e.jsx(W,{position:"end",children:e.jsx("img",{src:se,alt:"search"})})}})]}),e.jsxs(j,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(v,{type:"submit",variant:"contained",sx:{marginRight:2},children:"Zapisz"}),e.jsx(v,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:i,children:"Anuluj"})]})]})]})}const ne=({project:t,isEditClicked:i})=>{var P,y;const s=((P=t==null?void 0:t.taskIds)==null?void 0:P.length)??0,[u,r]=c.useState(!1),[x,o]=c.useState(null),[m,h]=c.useState(!1),l=E(),{requestDelete:p,confirmDelete:d,isConfirmOpen:f,closeModal:w}=z(),C=((y=t==null?void 0:t.taskIds)==null?void 0:y.length)??0,S=a=>{a.stopPropagation(),o(a.currentTarget),r(!0)},k=c.useCallback(a=>{a.stopPropagation(),r(!1),t&&p({id:t.id,type:"project"},b.getState().deleteProject)},[t,p]),F=c.useCallback(a=>{a.stopPropagation(),r(!1),h(!0)},[]),O=()=>{h(!1)},A=()=>{l(`/projects/${t==null?void 0:t.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(L,{onClick:A,sx:{width:"400px",position:"relative"},children:[e.jsx(_,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:a=>{a.stopPropagation(),i?k(a):S(a)},children:i?e.jsx("img",{src:R,alt:"Usuń"}):e.jsx("img",{src:G,alt:"Więcej opcji"})}),e.jsxs(n,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(n,{item:!0,xs:7,children:[e.jsx(n,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(g,{children:t==null?void 0:t.title})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(N,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}}})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(n,{item:!0,xs:!0,children:(t==null?void 0:t.dueDate)&&e.jsx($,{date:t.dueDate})})})]}),e.jsxs(n,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(n,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(te,{value:s})}),e.jsxs(n,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:ee,alt:"Tasks"}),e.jsx(g,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${C??0} ${C===1?"zadanie":"zadań"}`})]})]}),e.jsx(n,{})]}),e.jsx(V,{open:u,anchorEl:x,onClose:()=>r(!1),onEdit:a=>F(a),onDelete:k}),e.jsx(q,{isOpen:f,onDeleteConfirm:d,onClose:w,itemName:t==null?void 0:t.title,itemType:"project"})]}),e.jsx(B,{isOpen:m,handleClose:O,project:t,mode:"edit"})]})};function ie(){const t=Y(),i=Q(t.breakpoints.down("md")),[s,u]=c.useState(!1),[r,x]=c.useState(!1),{projects:o,fetchProjects:m}=b();console.log("Projects:",o),c.useEffect(()=>{m()},[m]);const h=d=>{d.stopPropagation(),u(f=>!f),console.log("Edit action triggered")};function l(){x(!1)}const p=d=>{d.stopPropagation(),x(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(n,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(n,{item:!0,children:e.jsx(M,{leftButtonLabel:"Projekty",rightButtonLabel:"Tablica",leftButtonLink:"/projects",rightButtonLink:"/tablica"})}),e.jsx(U,{handleAdd:p,handleEditAll:h,children:"Projekt"})]}),e.jsx(n,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:i?"column":"row",[t.breakpoints.up("md")]:{alignItems:"flex-start"},[t.breakpoints.down("md")]:{alignItems:"center"}},children:o.map(d=>e.jsx(ne,{project:d,handleTaskClick:()=>{},isEditClicked:s},d.id))}),e.jsx(B,{isOpen:r,handleClose:l,mode:"add"})]})}const ge=()=>e.jsx(e.Fragment,{children:e.jsx(T,{children:e.jsx(ie,{})})});export{ge as default};
