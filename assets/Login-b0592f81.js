import{g as I,a as _,b as S,c as U,s as T,d as F,_ as g,r as c,u as K,e as J,j as o,f as X,h as G,i as w,k as Q}from"./index-3acaad7c.js";import{S as Y,a as ee}from"./StyledLink-0d23d45e.js";import{u as y,M as u}from"./formik.esm-ab725934.js";import{c as j,a as m,b as oe}from"./index.esm-a70dc1d0.js";import{T as f,u as se,a as re,B as C,L as ae}from"./Logo-09549119.js";import{D as te,C as D,a as L}from"./CloseButton-6e9da0b5.js";import{D as E}from"./DialogTitle-4d742dc5.js";import{D as M}from"./DialogActions-cad18663.js";import"./createSvgIcon-717eaafd.js";function ne(r){return _("MuiLink",r)}const ie=I("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),le=ie,R={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},de=r=>R[r]||r,ce=({theme:r,ownerState:s})=>{const n=de(s.color),i=S(r,`palette.${n}`,!1)||s.color,e=S(r,`palette.${n}Channel`);return"vars"in r&&e?`rgba(${e} / 0.4)`:U(i,.4)},ue=ce,me=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],he=r=>{const{classes:s,component:n,focusVisible:i,underline:e}=r,a={root:["root",`underline${F(e)}`,n==="button"&&"button",i&&"focusVisible"]};return G(a,ne,s)},pe=T(f,{name:"MuiLink",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:n}=r;return[s.root,s[`underline${F(n.underline)}`],n.component==="button"&&s.button]}})(({theme:r,ownerState:s})=>g({},s.underline==="none"&&{textDecoration:"none"},s.underline==="hover"&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},s.underline==="always"&&g({textDecoration:"underline"},s.color!=="inherit"&&{textDecorationColor:ue({theme:r,ownerState:s})},{"&:hover":{textDecorationColor:"inherit"}}),s.component==="button"&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${le.focusVisible}`]:{outline:"auto"}})),fe=c.forwardRef(function(s,n){const i=K({props:s,name:"MuiLink"}),{className:e,color:a="primary",component:l="a",onBlur:t,onFocus:d,TypographyClasses:h,underline:B="always",variant:b="inherit",sx:x}=i,V=J(i,me),{isFocusVisibleRef:P,onBlur:z,onFocus:$,ref:A}=se(),[N,v]=c.useState(!1),O=re(n,A),Z=p=>{z(p),P.current===!1&&v(!1),t&&t(p)},q=p=>{$(p),P.current===!0&&v(!0),d&&d(p)},k=g({},i,{color:a,component:l,focusVisible:N,underline:B,variant:b}),H=he(k);return o.jsx(pe,g({color:a,className:X(H.root,e),classes:h,component:l,onBlur:Z,onFocus:q,ref:O,ownerState:k,variant:b,sx:[...Object.keys(R).includes(a)?[]:[{color:a}],...Array.isArray(x)?x:[x]]},V))}),ge=fe,we=({onForgotPasswordClick:r})=>{const{login:s,isLoggedIn:n}=w(),i=Q(),[e,a]=c.useState(!1),l=j({email:m().required("To pole jest wymagane").matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/u,"Nieprawidłowy adres email"),password:m().required("To pole jest wymagane").min(8,"Min 8 znaków")}),t=y({initialValues:{email:"coolcoder2000@gmail.com",password:"Otheridk1."},onSubmit:async d=>{a(!0);try{await s(d),i("/home")}catch(h){console.error("Login failed:",h)}finally{a(!1),t.resetForm()}},validationSchema:l});return c.useEffect(()=>{n&&i("/home")}),o.jsxs(Y,{onSubmit:t.handleSubmit,children:[o.jsx(f,{variant:"h5",align:"center",children:"Jesteś już użytkownikiem?"}),o.jsx(u,{id:"email",name:"email",label:"Email",type:"email",autoComplete:"on",variant:"standard",value:t.values.email,onChange:t.handleChange,error:t.touched.email&&!!t.errors.email,helperText:t.touched.email&&t.errors.email,fullWidth:!0,sx:{mt:3}}),o.jsx(u,{id:"password",name:"password",label:"Hasło",type:"password",autoComplete:"on",variant:"standard",value:t.values.password,onChange:t.handleChange,error:t.touched.password&&!!t.errors.password,helperText:t.touched.password&&t.errors.password,fullWidth:!0,sx:{mb:3}}),r&&o.jsx(f,{alignSelf:"flex-end",children:o.jsx(ge,{href:"#",onClick:r,children:"Nie pamiętam hasła"})}),o.jsx(C,{variant:"contained",fullWidth:!0,type:"submit",disabled:e,children:e?"Logowanie...":"Zaloguj się"}),o.jsxs(f,{fontSize:"1rem",children:["Nie masz konta? ",o.jsx(ee,{to:"/register",children:"Załóż konto"})]})]})},W=T(te)(({theme:r})=>({"& .MuiDialogContent-root":{paddingInline:"16px",paddingTop:0},"& .MuiDialogActions-root":{justifyContent:"center",paddingInline:"16px"},"& .MuiDialog-paper":{maxWidth:"550px",padding:"20px 60px",[r.breakpoints.down("sm")]:{padding:"10px 6px"}}})),xe=j({forgotPasswordEmail:m().email("Nieprawidłowy adres email").required("Email jest wymagany")}),ye=({isOpen:r,handleClose:s,onResetSuccess:n})=>{const{resetPassword:i}=w(),e=y({initialValues:{forgotPasswordEmail:""},validationSchema:xe,onSubmit:async(a,{setSubmitting:l})=>{l(!0);try{await i(a.forgotPasswordEmail),console.log(a.forgotPasswordEmail),console.log("Password reset email sent to",a.forgotPasswordEmail),s(),n(a.forgotPasswordEmail)}catch(t){console.error("Failed to send password reset email",t)}finally{l(!1)}}});return o.jsx("div",{children:o.jsxs(W,{fullWidth:!0,maxWidth:"sm",open:r,onClose:s,children:[o.jsxs(E,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Zapomniałem hasła",o.jsx(D,{onClick:s})]}),o.jsxs("form",{onSubmit:e.handleSubmit,children:[o.jsx(L,{children:o.jsx(u,{autoFocus:!0,margin:"dense",id:"forgotPasswordEmail",label:"Email",type:"email",fullWidth:!0,variant:"standard",value:e.values.forgotPasswordEmail,onChange:e.handleChange,error:e.touched.forgotPasswordEmail&&!!e.errors.forgotPasswordEmail,helperText:e.touched.forgotPasswordEmail&&e.errors.forgotPasswordEmail})}),o.jsx(M,{children:o.jsx(C,{variant:"contained",sx:{textAlign:"center"},type:"submit",fullWidth:!0,children:"Wyślij"})})]})]})})},je=j({resetCode:m().required("Kod resetujący jest wymagany"),newPassword:m().min(8,"Hasło musi zawierać co najmniej 8 znaków").required("Nowe hasło jest wymagane"),repeatPassword:m().oneOf([oe("newPassword")],"Hasła nie pasują").required("Powtożenie hasła jest wymagane")}),Ce=({isOpen:r,handleClose:s,onResetSuccess:n})=>{const{changePassword:i}=w(),e=y({initialValues:{resetCode:"",newPassword:"",repeatPassword:""},validationSchema:je,onSubmit:async(a,{setSubmitting:l})=>{l(!0);try{await i(a.resetCode,a.newPassword,a.repeatPassword),console.log("Password has been reset successfully"),s(),n(a.resetCode)}catch(t){console.error("Failed to reset password",t)}finally{l(!1)}}});return c.useEffect(()=>{r&&navigator.clipboard.readText().then(a=>{a&&a.length===6&&e.setFieldValue("resetCode",a)}).catch(a=>console.error("Failed to read clipboard contents",a))},[r,e]),o.jsxs(W,{fullWidth:!0,maxWidth:"sm",open:r,onClose:s,children:[o.jsxs(E,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Resetowanie hasła",o.jsx(D,{onClick:s})]}),o.jsxs("form",{onSubmit:e.handleSubmit,children:[o.jsxs(L,{children:[o.jsx(u,{margin:"dense",id:"resetCode",label:"Kod resetujący",type:"text",fullWidth:!0,variant:"standard",value:e.values.resetCode,onChange:e.handleChange,error:e.touched.resetCode&&!!e.errors.resetCode,helperText:e.touched.resetCode&&e.errors.resetCode}),o.jsx(u,{margin:"dense",id:"newPassword",label:"Nowe hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.newPassword,onChange:e.handleChange,error:e.touched.newPassword&&!!e.errors.newPassword,helperText:e.touched.newPassword&&e.errors.newPassword}),o.jsx(u,{margin:"dense",id:"repeatPassword",label:"Powtórz hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.repeatPassword,onChange:e.handleChange,error:e.touched.repeatPassword&&!!e.errors.repeatPassword,helperText:e.touched.repeatPassword&&e.errors.repeatPassword})]}),o.jsx(M,{children:o.jsx(C,{variant:"contained",type:"submit",fullWidth:!0,children:"Zresetuj hasło"})})]})]})},Ee=()=>{const[r,s]=c.useState(!1),{resetPassword:n}=w(),[i,e]=c.useState(!1),a=()=>s(!0),l=()=>s(!1),t=async d=>{try{await n(d),s(!1),e(!0)}catch(h){console.error("Reset password failed:",h)}};return o.jsxs("div",{style:{position:"relative",maxHeight:"100%",height:"100vh"},children:[o.jsx("img",{src:ae,alt:"OnTrack Logo",style:{position:"absolute",top:"50px",width:"240px",left:"50%",transform:"translateX(-50%)"}}),o.jsx(we,{onForgotPasswordClick:a}),o.jsx(ye,{isOpen:r,handleClose:l,onResetSuccess:d=>{console.log("Reset email sent to:",d),e(!0)}}),o.jsx(Ce,{isOpen:i,handleClose:()=>e(!1),onResetSuccess:t})]})};export{Ee as default};
