import{g as H,a as _,b as T,c as U,s as D,d as F,_ as g,r as c,u as K,e as J,j as o,f as Q,h as G,i as w,k as X,B as Y}from"./index-c79e8087.js";import{S as ee,a as oe}from"./StyledLink-e4f4459f.js";import{c as j,a as m,u as C,M as p,b as se}from"./index.esm-f6b22d87.js";import{T as f,u as re,a as ae,B as b}from"./Button-d362f979.js";import{D as te,C as L,a as M}from"./CloseButton-0b83b7b5.js";import{D as E}from"./DialogTitle-f20d710d.js";import{D as R}from"./DialogActions-376d12fa.js";import{L as ne}from"./Logo-c74f2329.js";import{u as ie}from"./useMediaQuery-0140dc33.js";import"./createSvgIcon-7c2d8988.js";function le(r){return _("MuiLink",r)}const de=H("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),ce=de,W={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},ue=r=>W[r]||r,me=({theme:r,ownerState:s})=>{const n=ue(s.color),i=T(r,`palette.${n}`,!1)||s.color,e=T(r,`palette.${n}Channel`);return"vars"in r&&e?`rgba(${e} / 0.4)`:U(i,.4)},pe=me,he=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],fe=r=>{const{classes:s,component:n,focusVisible:i,underline:e}=r,a={root:["root",`underline${F(e)}`,n==="button"&&"button",i&&"focusVisible"]};return G(a,le,s)},ge=D(f,{name:"MuiLink",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:n}=r;return[s.root,s[`underline${F(n.underline)}`],n.component==="button"&&s.button]}})(({theme:r,ownerState:s})=>g({},s.underline==="none"&&{textDecoration:"none"},s.underline==="hover"&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},s.underline==="always"&&g({textDecoration:"underline"},s.color!=="inherit"&&{textDecorationColor:pe({theme:r,ownerState:s})},{"&:hover":{textDecorationColor:"inherit"}}),s.component==="button"&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${ce.focusVisible}`]:{outline:"auto"}})),we=c.forwardRef(function(s,n){const i=K({props:s,name:"MuiLink"}),{className:e,color:a="primary",component:l="a",onBlur:t,onFocus:u,TypographyClasses:d,underline:x="always",variant:P="inherit",sx:y}=i,V=J(i,he),{isFocusVisibleRef:v,onBlur:z,onFocus:$,ref:A}=re(),[N,k]=c.useState(!1),O=ae(n,A),I=h=>{z(h),v.current===!1&&k(!1),t&&t(h)},Z=h=>{$(h),v.current===!0&&k(!0),u&&u(h)},S=g({},i,{color:a,component:l,focusVisible:N,underline:x,variant:P}),q=fe(S);return o.jsx(ge,g({color:a,className:Q(q.root,e),classes:d,component:l,onBlur:I,onFocus:Z,ref:O,ownerState:S,variant:P,sx:[...Object.keys(W).includes(a)?[]:[{color:a}],...Array.isArray(y)?y:[y]]},V))}),xe=we,ye=({onForgotPasswordClick:r})=>{const{login:s,isLoggedIn:n}=w(),i=X(),[e,a]=c.useState(!1),l=j({email:m().required("To pole jest wymagane").matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/u,"Nieprawidłowy adres email"),password:m().required("To pole jest wymagane").min(8,"Min 8 znaków")}),t=C({initialValues:{email:"coolcoder2000@gmail.com",password:"Otheridk1."},onSubmit:async u=>{a(!0);try{await s(u),i("/")}catch(d){console.error("Login failed:",d)}finally{a(!1),t.resetForm()}},validationSchema:l});return c.useEffect(()=>{n&&i("/")}),o.jsxs(ee,{onSubmit:t.handleSubmit,children:[o.jsx(f,{variant:"h5",align:"center",children:"Jesteś już użytkownikiem?"}),o.jsx(p,{id:"email",name:"email",label:"Email",type:"email",autoComplete:"on",variant:"standard",value:t.values.email,onChange:t.handleChange,error:t.touched.email&&!!t.errors.email,helperText:t.touched.email&&t.errors.email,fullWidth:!0,sx:{mt:3}}),o.jsx(p,{id:"password",name:"password",label:"Hasło",type:"password",autoComplete:"on",variant:"standard",value:t.values.password,onChange:t.handleChange,error:t.touched.password&&!!t.errors.password,helperText:t.touched.password&&t.errors.password,fullWidth:!0,sx:{mb:3}}),r&&o.jsx(f,{alignSelf:"flex-end",children:o.jsx(xe,{href:"#",onClick:r,children:"Nie pamiętam hasła"})}),o.jsx(b,{variant:"contained",fullWidth:!0,type:"submit",disabled:e,children:e?"Logowanie...":"Zaloguj się"}),o.jsxs(f,{fontSize:"1rem",children:["Nie masz konta? ",o.jsx(oe,{to:"/register",children:"Załóż konto"})]})]})},B=D(te)(({theme:r})=>({"& .MuiDialogContent-root":{paddingInline:"16px",paddingTop:0},"& .MuiDialogActions-root":{justifyContent:"center",paddingInline:"16px"},"& .MuiDialog-paper":{maxWidth:"550px",padding:"20px 60px",[r.breakpoints.down("sm")]:{padding:"10px 6px"}}})),je=j({forgotPasswordEmail:m().email("Nieprawidłowy adres email").required("Email jest wymagany")}),Ce=({isOpen:r,handleClose:s,onResetSuccess:n})=>{const{resetPassword:i}=w(),e=C({initialValues:{forgotPasswordEmail:""},validationSchema:je,onSubmit:async(a,{setSubmitting:l})=>{l(!0);try{await i(a.forgotPasswordEmail),console.log(a.forgotPasswordEmail),console.log("Password reset email sent to",a.forgotPasswordEmail),s(),n(a.forgotPasswordEmail)}catch(t){console.error("Failed to send password reset email",t)}finally{l(!1)}}});return o.jsx("div",{children:o.jsxs(B,{fullWidth:!0,maxWidth:"sm",open:r,onClose:s,children:[o.jsxs(E,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Zapomniałem hasła",o.jsx(L,{onClick:s})]}),o.jsxs("form",{onSubmit:e.handleSubmit,children:[o.jsx(M,{children:o.jsx(p,{autoFocus:!0,margin:"dense",id:"forgotPasswordEmail",label:"Email",type:"email",fullWidth:!0,variant:"standard",value:e.values.forgotPasswordEmail,onChange:e.handleChange,error:e.touched.forgotPasswordEmail&&!!e.errors.forgotPasswordEmail,helperText:e.touched.forgotPasswordEmail&&e.errors.forgotPasswordEmail})}),o.jsx(R,{children:o.jsx(b,{variant:"contained",sx:{textAlign:"center"},type:"submit",fullWidth:!0,children:"Wyślij"})})]})]})})},be=j({resetCode:m().required("Kod resetujący jest wymagany"),newPassword:m().min(8,"Hasło musi zawierać co najmniej 8 znaków").required("Nowe hasło jest wymagane"),repeatPassword:m().oneOf([se("newPassword")],"Hasła nie pasują").required("Powtożenie hasła jest wymagane")}),Pe=({isOpen:r,handleClose:s,onResetSuccess:n})=>{const{changePassword:i}=w(),e=C({initialValues:{resetCode:"",newPassword:"",repeatPassword:""},validationSchema:be,onSubmit:async(a,{setSubmitting:l})=>{l(!0);try{await i(a.resetCode,a.newPassword,a.repeatPassword),console.log("Password has been reset successfully"),s(),n(a.resetCode)}catch(t){console.error("Failed to reset password",t)}finally{l(!1)}}});return c.useEffect(()=>{r&&navigator.clipboard.readText().then(a=>{a&&a.length===6&&e.setFieldValue("resetCode",a)}).catch(a=>console.error("Failed to read clipboard contents",a))},[r,e]),o.jsxs(B,{fullWidth:!0,maxWidth:"sm",open:r,onClose:s,children:[o.jsxs(E,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Resetowanie hasła",o.jsx(L,{onClick:s})]}),o.jsxs("form",{onSubmit:e.handleSubmit,children:[o.jsxs(M,{children:[o.jsx(p,{margin:"dense",id:"resetCode",label:"Kod resetujący",type:"text",fullWidth:!0,variant:"standard",value:e.values.resetCode,onChange:e.handleChange,error:e.touched.resetCode&&!!e.errors.resetCode,helperText:e.touched.resetCode&&e.errors.resetCode}),o.jsx(p,{margin:"dense",id:"newPassword",label:"Nowe hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.newPassword,onChange:e.handleChange,error:e.touched.newPassword&&!!e.errors.newPassword,helperText:e.touched.newPassword&&e.errors.newPassword}),o.jsx(p,{margin:"dense",id:"repeatPassword",label:"Powtórz hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.repeatPassword,onChange:e.handleChange,error:e.touched.repeatPassword&&!!e.errors.repeatPassword,helperText:e.touched.repeatPassword&&e.errors.repeatPassword})]}),o.jsx(R,{children:o.jsx(b,{variant:"contained",type:"submit",fullWidth:!0,children:"Zresetuj hasło"})})]})]})},We=()=>{const[r,s]=c.useState(!1),{resetPassword:n}=w(),[i,e]=c.useState(!1),a=()=>s(!0),l=()=>s(!1),t=async d=>{try{await n(d),s(!1),e(!0)}catch(x){console.error("Reset password failed:",x)}},u=ie("(max-width:400px)");return o.jsxs(Y,{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",position:"relative"},children:[o.jsx("img",{src:ne,alt:"OnTrack Logo",style:{width:"240px",position:"absolute",top:u?"25px":"50px"}}),o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:o.jsx(ye,{onForgotPasswordClick:a})}),o.jsx(Ce,{isOpen:r,handleClose:l,onResetSuccess:d=>{console.log("Reset email sent to:",d),e(!0)}}),o.jsx(Pe,{isOpen:i,handleClose:()=>e(!1),onResetSuccess:t})]})};export{We as default};
