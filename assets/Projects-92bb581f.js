import{g as H,a as J,s as K,_ as G,r as i,u as X,e as ee,j as e,f as L,h as te,B as M,C as F,i as q,q as R,k as se,p as ae}from"./index-166e65de.js";import{a as ne,A as O,M as re}from"./MainLayout-55f46c5b.js";import{u as W,B as ie}from"./ProjectStore-095a1304.js";import{S as T,I as oe,d as le,a as U,u as de,G as ce,C as ue,M as me,b as xe,D as pe,O as he,c as fe,A as ge,N as je}from"./NoContent-dc28008a.js";import{T as y}from"./Button-893b62b5.js";import{u as be}from"./Logo-3ef40f16.js";import{D as ve,C as ye,a as Ce,d as ke}from"./CloseButton-2f0fd004.js";import{c as Me,a as Pe,u as Ae}from"./index.esm-0288159c.js";import{D as Ie}from"./DialogTitle-dcfea0a0.js";import{I as Z}from"./createSvgIcon-9210599a.js";import{G as j}from"./Grid-8d85b4fb.js";import{u as Se}from"./useMediaQuery-bdb7d64b.js";function we(t){return J("MuiAvatarGroup",t)}const $e=H("MuiAvatarGroup",["root","avatar"]),Be=$e,De=["children","className","component","componentsProps","max","renderSurplus","slotProps","spacing","total","variant"],V={small:-16,medium:null},Ne=t=>{const{classes:r}=t;return te({root:["root"],avatar:["avatar"]},we,r)},ze=K("div",{name:"MuiAvatarGroup",slot:"Root",overridesResolver:(t,r)=>G({[`& .${Be.avatar}`]:r.avatar},r.root)})(({theme:t,ownerState:r})=>{const a=r.spacing&&V[r.spacing]!==void 0?V[r.spacing]:-r.spacing;return{[`& .${ne.root}`]:{border:`2px solid ${(t.vars||t).palette.background.default}`,boxSizing:"content-box",marginLeft:a??-8,"&:last-child":{marginLeft:0}},display:"flex",flexDirection:"row-reverse"}}),Ee=i.forwardRef(function(r,a){var l;const h=X({props:r,name:"MuiAvatarGroup"}),{children:B,className:d,component:C="div",componentsProps:A={},max:x=5,renderSurplus:c,slotProps:f={},spacing:I="medium",total:p,variant:g="circular"}=h,D=ee(h,De);let o=x<2?2:x;const z=G({},h,{max:x,spacing:I,component:C,variant:g}),N=Ne(z),S=i.Children.toArray(B).filter(k=>i.isValidElement(k)),u=p||S.length;u===o&&(o+=1),o=Math.min(u+1,o);const w=Math.min(S.length,o-1),P=Math.max(u-o,u-w,0),E=c?c(P):`+${P}`,$=(l=f.additionalAvatar)!=null?l:A.additionalAvatar;return e.jsxs(ze,G({as:C,ownerState:z,className:L(N.root,d),ref:a},D,{children:[P?e.jsx(O,G({variant:g},$,{className:L(N.avatar,$==null?void 0:$.className),children:E})):null,S.slice(0,w).reverse().map(k=>i.cloneElement(k,{className:L(k.props.className,N.avatar),variant:k.props.variant||g}))]}))}),Fe=Ee,Ge="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",Oe=({value:t,size:r=100,...a})=>e.jsxs(M,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(F,{variant:"determinate",value:100,size:r,sx:{color:"#5E5F7D",...a.sx}}),e.jsx(F,{variant:"determinate",value:t,size:r,sx:{position:"absolute",left:0,...a.sx}}),e.jsx(M,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(y,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(t)}%`})})]}),We=({members:t,width:r,height:a})=>e.jsx(Fe,{max:3,sx:{display:"flex",justifyContent:"flex-end"},children:t.map((l,h)=>e.jsx(O,{alt:`${l.firstName} ${l.lastName}`,sx:{width:r,height:a}},l.id??h))}),_="https://ontrackbackendapi2.azurewebsites.net/api",Le=Me({title:Pe().trim().min(1,"Tytuł projektu musi zawierać co najmniej 1 znak.").required("Tytuł projektu jest wymagany.")});function Q({isOpen:t,handleClose:r,project:a,mode:l}){var P,E,$,k;const{addProject:h,updateProject:B}=W(),{user:d,token:C}=q(),[A,x]=i.useState([]),[c,f]=i.useState([]),[I,p]=i.useState(null),[g,D]=i.useState(!1),o=i.useRef(null);i.useEffect(()=>{t&&(async()=>{var n;if(D(!0),l==="edit"&&((n=a==null?void 0:a.memberIds)!=null&&n.length))try{const m=await R.get(`${_}/user/by/ids/${a.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${C}`}});f(m.data)}catch(m){console.error("Error fetching project members:",m)}else f([]);D(!1)})()},[t,l,a,C]);const z=async()=>{var n;const s=((n=o.current)==null?void 0:n.value)||"";if(s)try{const b=(await R.get(`${_}/user/search/${s}`,{headers:{Authorization:`Bearer ${C}`}})).data.filter(v=>v.id!==(d==null?void 0:d.id)&&!c.some(Y=>Y.id===v.id));x(b),console.log("Members fetched successfully:",b)}catch(m){console.error("Error fetching members:",m)}else x([])},N=s=>{if(!c.find(n=>n.id===s.id)){const n=[...c,s];f(n),console.log("Selected members:",n),u.setFieldValue("memberIds",n.map(m=>m.id))}o.current&&(o.current.value=""),x([])},S=s=>{if(c.length===1){p("Projekt musi mieć co najmniej jednego członka.");return}const n=c.filter(m=>m.id!==s);f(n),u.setFieldValue("memberIds",n.map(m=>m.id))},u=Ae({initialValues:{title:(a==null?void 0:a.title)??"",description:(a==null?void 0:a.description)??"",memberIds:l==="edit"?c.map(s=>s.id):[]},validationSchema:Le,onSubmit:async(s,{setSubmitting:n,resetForm:m})=>{const b={...a,title:s.title,description:s.description,memberIds:s.memberIds};console.log("Submitting data:",b);try{l==="add"?(await h({...b,memberIds:c.filter(v=>v.id!==void 0).map(v=>v.id)}),console.log("Adding project:",b)):l==="edit"&&(a!=null&&a.id)&&(await B(a.id,{...b,memberIds:c.filter(v=>v.id!==void 0).map(v=>v.id)}),console.log("Project updated:",b)),m(),o.current.value="",x([]),f([]),p(null),r()}catch(v){console.error("Error submitting the project:",v)}finally{n(!1)}},enableReinitialize:!0}),w=()=>{u.resetForm(),o.current.value="",x([]),f([]),p(null),r()};return e.jsxs(ve,{fullWidth:!0,maxWidth:"md",open:t,onClose:w,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(Ie,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:l==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(ye,{onClick:w,right:20,top:20}),e.jsxs("form",{onSubmit:u.handleSubmit,children:[e.jsxs(Ce,{sx:{paddingBottom:12},children:[e.jsx(y,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(T,{fullWidth:!0,variant:"filled",name:"title",value:u.values.title,onChange:u.handleChange,placeholder:"Wpisz nazwę projektu",sx:{width:300}}),u.touched.title&&u.errors.title?e.jsx(y,{color:"error",variant:"caption",children:u.errors.title}):null,e.jsx(y,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(T,{fullWidth:!0,variant:"filled",placeholder:"Wyszukaj członków",sx:{width:300},inputRef:o,onChange:z,endAdornment:e.jsx(oe,{position:"end",children:e.jsx(le,{})})}),((P=o.current)==null?void 0:P.value)&&A.length===0&&!g&&e.jsx(y,{color:"textSecondary",variant:"body2",children:"Brak wyników"}),((E=o.current)==null?void 0:E.value)&&g&&e.jsx(M,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(F,{})}),!(($=o.current)!=null&&$.value)&&g&&e.jsx(M,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(F,{})}),!g&&e.jsxs(e.Fragment,{children:[((k=o.current)==null?void 0:k.value)&&A.map(s=>e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:2,mt:2,borderRadius:"5px",transition:"background-color 0.4s ease-in-out",":hover":{cursor:"pointer",backgroundColor:"#f0f0f0"}},onClick:()=>N(s),children:[e.jsx(O,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(y,{children:[s.firstName," ",s.lastName]})]},s.id)),e.jsx(M,{mt:4,children:c.map(s=>e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[e.jsx(O,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(y,{children:[s.firstName," ",s.lastName]}),s.id!==(d==null?void 0:d.id)&&e.jsx(Z,{onClick:()=>S(s.id??""),children:e.jsx(ke,{})})]},s.id))})]}),I&&e.jsx(y,{color:"error",variant:"caption",children:I})]}),e.jsxs(M,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(U,{type:"submit",variant:"contained",sx:{marginRight:2},children:"Zapisz"}),e.jsx(U,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:w,children:"Anuluj"})]})]})]})}const Re="https://ontrackbackendapi2.azurewebsites.net/api",Te=({project:t,isEditClicked:r})=>{var s;const a=se(),{projectProgress:l}=W(),h=t.id&&l[t.id]||0,[B,d]=i.useState(!1),[C,A]=i.useState(null),[x,c]=i.useState(!1),[f,I]=i.useState([]),[p,g]=i.useState(!1),{requestDelete:D,confirmDelete:o,isConfirmOpen:z,closeModal:N}=de(),S=((s=t==null?void 0:t.taskIds)==null?void 0:s.length)??0,{token:u}=q();i.useEffect(()=>{(async()=>{var m;if(g(!0),(m=t==null?void 0:t.memberIds)!=null&&m.length)try{const b=await R.get(`${Re}/user/by/ids/${t.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${u}`}});I(b.data)}catch(b){console.error("Error fetching project members:",b)}g(!1)})()},[t,u]);const w=n=>{n.stopPropagation(),A(n.currentTarget),d(!0)},P=i.useCallback(n=>{n.stopPropagation(),d(!1),t&&D({id:t.id,type:"project"},W.getState().deleteProject)},[t,D]),E=i.useCallback(n=>{n.stopPropagation(),d(!1),c(!0)},[]),$=()=>{c(!1)},k=()=>{a(`/projects/${t==null?void 0:t.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{onClick:k,sx:{width:"400px",position:"relative"},children:[e.jsx(Z,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:n=>{n.stopPropagation(),r?P(n):w(n)},children:r?e.jsx("img",{src:ue,alt:"Usuń"}):e.jsx("img",{src:me,alt:"Więcej opcji"})}),e.jsxs(j,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(j,{item:!0,xs:7,children:[e.jsx(j,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(y,{children:t==null?void 0:t.title})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(xe,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}},children:p?e.jsx(M,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(F,{})}):f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"subtitle2",color:"text.secondary",children:"Zespół"}),e.jsx(We,{members:f})," "]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(j,{item:!0,xs:!0,children:(t==null?void 0:t.dueDate)&&e.jsx(pe,{date:t.dueDate})})})]}),e.jsxs(j,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(j,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(Oe,{value:h})}),e.jsxs(j,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:Ge,alt:"Tasks"}),e.jsx(y,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${S??0} ${S===1?"zadanie":"zadań"}`})]})]}),e.jsx(j,{})]}),e.jsx(he,{open:B,anchorEl:C,onClose:()=>d(!1),onEdit:n=>E(n),onDelete:P}),e.jsx(fe,{isOpen:z,onDeleteConfirm:o,onClose:N,itemName:t==null?void 0:t.title,itemType:"project"})]}),e.jsx(Q,{isOpen:x,handleClose:$,project:t,mode:"edit"})]})};function Ue(){const[t,r]=i.useState(!1),[a,l]=i.useState(!1),h=be(),B=Se(h.breakpoints.down("md")),{projects:d,fetchUserProjects:C,loading:A,error:x}=W();console.log("User projects:",d),i.useEffect(()=>{C()},[C]);const c=p=>{p.stopPropagation(),r(g=>!g),console.log("Edit action triggered")};function f(){l(!1)}const I=p=>{p.stopPropagation(),l(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(j,{item:!0,children:e.jsx(ie,{leftButtonLabel:"Projekty",rightButtonLabel:"Wykres",leftButtonLink:"/projects",rightButtonLink:"/wykres"})}),e.jsx(ge,{handleAdd:I,handleEditAll:c,children:"Projekt"})]}),A?e.jsx(ae,{}):x?e.jsx(M,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(y,{color:"error",children:x})}):d.length===0?e.jsx(je,{type:"project"}):e.jsx(j,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:B?"column":"row",[h.breakpoints.up("md")]:{alignItems:"flex-start"},[h.breakpoints.down("md")]:{alignItems:"center"}},children:d.map(p=>e.jsx(Te,{project:p,isEditClicked:t},p.id))}),e.jsx(Q,{isOpen:a,handleClose:f,mode:"add"})]})}const st=()=>e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsx(Ue,{})})});export{st as default};
