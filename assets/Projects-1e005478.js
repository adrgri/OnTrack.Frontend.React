import{j as e,B as p,C as P,i as G,r,q as U,k as Q,p as J}from"./index-28f2f15b.js";import{A as _,M as K}from"./MainLayout-21524f80.js";import{u as N,B as X}from"./ProjectStore-c79f291f.js";import{u as ee,S as q,I as te,a as V,b as se,G as ne,C as ae,M as ie,c as re,d as oe,D as le,O as de,e as ce,A as ue,N as me}from"./NoContent-87c97429.js";import{T as u}from"./Button-1234832a.js";import{r as xe,i as he,I as Z}from"./createSvgIcon-be9e4da0.js";import{D as fe,C as pe,a as ge,d as je}from"./CloseButton-96b7970d.js";import{c as be,a as ye,u as Ce}from"./index.esm-fd29937e.js";import{D as ke}from"./DialogTitle-a29466c6.js";import{G as l}from"./Grid-0e684cd3.js";import{u as ve}from"./Logo-73d4f949.js";import{u as Ie}from"./useMediaQuery-4ea1f355.js";const Me="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",Se=({value:t,size:g=100,...n})=>e.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(P,{variant:"determinate",value:100,size:g,sx:{color:"#5E5F7D",...n.sx}}),e.jsx(P,{variant:"determinate",value:t,size:g,sx:{position:"absolute",left:0,...n.sx}}),e.jsx(p,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(u,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(t)}%`})})]});var R={},Pe=he;Object.defineProperty(R,"__esModule",{value:!0});var Y=R.default=void 0,we=Pe(xe()),De=e,Be=(0,we.default)((0,De.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");Y=R.default=Be;const ze="https://ontrackbackendapi2.azurewebsites.net/api",Fe=be({title:ye().trim().min(1,"Tytuł projektu musi zawierać co najmniej 1 znak.").required("Tytuł projektu jest wymagany.")});function H({isOpen:t,handleClose:g,project:n,mode:m}){var L,F,i,A;const{addProject:y,updateProject:w}=N(),{user:d,token:C}=G(),[a,o]=r.useState([]),[k,b]=r.useState(null),[D,x]=r.useState(!1),[v,B]=r.useState(!1),{searchMemberRef:I,members:E,isLoadingMembers:M,handleSearchChange:$,clearSearchInput:S}=ee(!0,a);r.useEffect(()=>{t&&(async()=>{var c;if(x(!0),m==="edit"&&((c=n==null?void 0:n.memberIds)!=null&&c.length))try{const f=await U.get(`${ze}/user/by/ids/${n.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${C}`}});o(f.data)}catch(f){console.error("Error fetching project members:",f)}else o([]);x(!1)})()},[t,m,n,C]);const W=s=>{if(!a.find(c=>c.id===s.id)){const c=[...a,s];o(c),h.setFieldValue("memberIds",c.map(f=>f.id)),S()}},O=s=>{if(a.length===1){b("Projekt musi mieć co najmniej jednego członka.");return}const c=a.filter(f=>f.id!==s);o(c),h.setFieldValue("memberIds",c.map(f=>f.id))},h=Ce({initialValues:{title:(n==null?void 0:n.title)??"",description:(n==null?void 0:n.description)??"",memberIds:m==="edit"?a.map(s=>s.id):[]},validationSchema:Fe,onSubmit:async(s,{setSubmitting:c,resetForm:f})=>{B(!0);const T={...n,title:s.title,description:s.description,memberIds:s.memberIds};try{m==="add"?await y({...T,memberIds:a.filter(j=>j.id!==void 0).map(j=>j.id)}):m==="edit"&&(n!=null&&n.id)&&await w(n.id,{...T,memberIds:a.filter(j=>j.id!==void 0).map(j=>j.id)}),f(),S(),o([]),b(null),g()}catch(j){console.error("Error submitting the project:",j)}finally{c(!1),B(!1)}},enableReinitialize:!0}),z=()=>{h.resetForm(),S(),o([]),b(null),g()};return e.jsxs(fe,{fullWidth:!0,maxWidth:"md",open:t,onClose:z,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(ke,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:m==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(pe,{onClick:z,right:20,top:20}),e.jsxs("form",{onSubmit:h.handleSubmit,children:[e.jsxs(ge,{sx:{paddingBottom:12},children:[e.jsx(u,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(q,{fullWidth:!0,variant:"filled",name:"title",value:h.values.title,onChange:h.handleChange,placeholder:"Wpisz nazwę projektu",sx:{width:300}}),h.touched.title&&h.errors.title?e.jsx(u,{color:"error",variant:"caption",children:h.errors.title}):null,e.jsx(u,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(q,{fullWidth:!0,variant:"filled",placeholder:"Wyszukaj członków",sx:{width:300},inputRef:I,onChange:$,endAdornment:e.jsx(te,{position:"end",children:e.jsx(Y,{})})}),((L=I.current)==null?void 0:L.value)&&E.length===0&&!M&&e.jsx(u,{color:"textSecondary",variant:"body2",children:"Brak wyników"}),((F=I.current)==null?void 0:F.value)&&M&&e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(P,{})}),!((i=I.current)!=null&&i.value)&&M&&e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(P,{})}),!M&&e.jsxs(e.Fragment,{children:[((A=I.current)==null?void 0:A.value)&&E.map(s=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mt:2,borderRadius:"5px",transition:"background-color 0.4s ease-in-out",":hover":{cursor:"pointer",backgroundColor:"#f0f0f0"}},onClick:()=>W(s),children:[e.jsx(_,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(u,{children:[s.firstName," ",s.lastName]})]},s.id)),D?e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(P,{})}):e.jsx(p,{mt:4,sx:{maxHeight:a.length>2?"100px":"auto",overflowY:a.length>2?"scroll":"visible"},children:a.map(s=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[e.jsx(_,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(u,{children:[s.firstName," ",s.lastName]}),s.id!==(d==null?void 0:d.id)&&e.jsx(Z,{onClick:()=>O(s.id??""),children:e.jsx(je,{})})]},s.id))})]}),k&&e.jsx(u,{color:"error",variant:"caption",children:k})]}),e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(V,{type:"submit",variant:"contained",sx:{marginRight:2},disabled:v,children:v?"Zapisywanie...":"Zapisz"}),e.jsx(V,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:z,children:"Anuluj"})]})]})]})}const Ae="https://ontrackbackendapi2.azurewebsites.net/api",Ee=({project:t,isEditClicked:g})=>{var F;const n=Q(),{projectProgress:m}=N(),y=t.id&&m[t.id]||0,[w,d]=r.useState(!1),[C,a]=r.useState(null),[o,k]=r.useState(!1),[b,D]=r.useState([]),[x,v]=r.useState(!1),{requestDelete:B,confirmDelete:I,isConfirmOpen:E,closeModal:M}=se(),$=((F=t==null?void 0:t.taskIds)==null?void 0:F.length)??0,{token:S}=G();r.useEffect(()=>{(async()=>{var A;if(v(!0),(A=t==null?void 0:t.memberIds)!=null&&A.length)try{const s=await U.get(`${Ae}/user/by/ids/${t.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${S}`}});D(s.data)}catch(s){console.error("Error fetching project members:",s)}v(!1)})()},[t,S]);const W=i=>{i.stopPropagation(),a(i.currentTarget),d(!0)},O=r.useCallback(i=>{i.stopPropagation(),d(!1),t&&B({id:t.id,type:"project"},N.getState().deleteProject)},[t,B]),h=r.useCallback(i=>{i.stopPropagation(),d(!1),k(!0)},[]),z=()=>{k(!1)},L=()=>{n(`/projects/${t==null?void 0:t.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{onClick:L,sx:{width:{xs:"100%",sm:"90%",md:"400px"},position:"relative"},children:[e.jsx(Z,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:i=>{i.stopPropagation(),g?O(i):W(i)},children:g?e.jsx("img",{src:ae,alt:"Usuń"}):e.jsx("img",{src:ie,alt:"Więcej opcji"})}),e.jsxs(l,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{item:!0,xs:7,children:[e.jsx(l,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(u,{children:t==null?void 0:t.title})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(re,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}},children:x?e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(P,{})}):b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"subtitle2",color:"text.secondary",children:"Zespół"}),e.jsx(oe,{members:b})," "]})})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(l,{item:!0,xs:!0,children:(t==null?void 0:t.dueDate)&&e.jsx(le,{date:t.dueDate})})})]}),e.jsxs(l,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(l,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(Se,{value:y})}),e.jsxs(l,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:Me,alt:"Tasks"}),e.jsx(u,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${$??0} ${$===1?"zadanie":"zadań"}`})]})]}),e.jsx(l,{})]}),e.jsx(de,{open:w,anchorEl:C,onClose:()=>d(!1),onEdit:i=>h(i),onDelete:O}),e.jsx(ce,{isOpen:E,onDeleteConfirm:I,onClose:M,itemName:t==null?void 0:t.title,itemType:"project"})]}),e.jsx(H,{isOpen:o,handleClose:z,project:t,mode:"edit"})]})};function $e(){const[t,g]=r.useState(!1),[n,m]=r.useState(!1),y=ve(),w=Ie(y.breakpoints.down("md")),{projects:d,fetchUserProjects:C,loading:a,error:o}=N();r.useEffect(()=>{C()},[C]);const k=x=>{x.stopPropagation(),g(v=>!v)};function b(){m(!1)}const D=x=>{x.stopPropagation(),m(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(l,{item:!0,children:e.jsx(X,{leftButtonLabel:"Projekty",rightButtonLabel:"Wykres",leftButtonLink:"/projects",rightButtonLink:"/wykres"})}),e.jsx(ue,{handleAdd:D,handleEditAll:k,children:"Projekt"})]}),a&&e.jsx(J,{}),o&&e.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(u,{color:"error",children:o})}),!a&&!o&&d.length===0&&e.jsx(me,{type:"project"}),!a&&!o&&d.length>0&&e.jsx(l,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:w?"column":"row",[y.breakpoints.up("md")]:{alignItems:"flex-start"},[y.breakpoints.down("md")]:{alignItems:"center"}},children:d.map(x=>e.jsx(Ee,{project:x,isEditClicked:t},x.id))}),e.jsx(H,{isOpen:n,handleClose:b,mode:"add"})]})}const Ye=()=>e.jsx(e.Fragment,{children:e.jsx(K,{children:e.jsx($e,{})})});export{Ye as default};
