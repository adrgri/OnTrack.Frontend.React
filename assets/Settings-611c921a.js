import{j as r,B as P,i as g,r as j,l as f}from"./index-1785b6ff.js";import{S as y,a as b}from"./StyledLink-dfa142aa.js";import{u as C,M as l,c as k,a as d,b as v}from"./index.esm-2dc4e779.js";import{A as S,M as z}from"./MainLayout-354599bd.js";import{G as B}from"./Grid-f40d980b.js";import{T as u,B as T}from"./Button-123d9d5f.js";import"./Logo-e206157c.js";import"./createSvgIcon-723a9021.js";const M=({name:a,avatar:m})=>{const n=m,h=a?a.charAt(0).toUpperCase():"";return r.jsx(P,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:r.jsx(S,{src:n,sx:{width:56,height:56,m:1},alt:`${a}'s avatar`,children:h})})},$=({initialValues:a,onSubmit:m,formTitle:n,submitButtonText:h,userProfile:i,bottomText:c,bottomLinkText:p,bottomLinkHref:w="/",validationSchema:t,passwordFieldProps:o,apiError:s})=>{const e=C({initialValues:a,onSubmit:N=>{m(N)},validationSchema:t});return r.jsxs(y,{onSubmit:e.handleSubmit,children:[r.jsxs(B,{item:!0,xs:12,container:!0,justifyContent:"space-between",children:[r.jsx(u,{component:"h1",variant:"h5",children:n}),i&&r.jsx(M,{name:i.name,avatar:i.avatar})]}),s&&r.jsx(P,{sx:{mt:2,mb:2},children:r.jsx(u,{color:"error",children:s})}),r.jsx(l,{id:"firstName",name:"firstName",label:"Imię",type:"text",autoComplete:"on",variant:"standard",value:e.values.firstName||"",onChange:e.handleChange,error:e.touched.firstName&&!!e.errors.firstName,helperText:e.touched.firstName&&e.errors.firstName,fullWidth:!0}),r.jsx(l,{id:"lastName",name:"lastName",label:"Nazwisko",type:"text",autoComplete:"on",variant:"standard",value:e.values.lastName||"",onChange:e.handleChange,error:e.touched.lastName&&!!e.errors.lastName,helperText:e.touched.lastName&&e.errors.lastName,fullWidth:!0}),r.jsx(l,{id:"email",name:"email",label:"Email",type:"email",autoComplete:"on",variant:"standard",value:e.values.email||"",onChange:e.handleChange,error:e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,fullWidth:!0,disabled:!0}),r.jsx(l,{id:"oldPassword",name:"oldPassword",label:"Stare hasło",type:"password",autoComplete:"old-password",variant:"standard",value:e.values.oldPassword||"",onChange:e.handleChange,error:e.touched.oldPassword&&!!e.errors.oldPassword,helperText:e.touched.oldPassword&&e.errors.oldPassword,fullWidth:!0,...o}),r.jsx(l,{id:"newPassword",name:"newPassword",label:"Nowe hasło",type:"password",autoComplete:"new-password",variant:"standard",value:e.values.newPassword||"",onChange:e.handleChange,error:e.touched.newPassword&&!!e.errors.newPassword,helperText:e.touched.newPassword&&e.errors.newPassword,fullWidth:!0,...o}),r.jsx(l,{id:"repeatPassword",name:"repeatPassword",label:"Powtórz hasło",type:"password",autoComplete:"repeat-password",variant:"standard",value:e.values.repeatPassword||"",onChange:e.handleChange,error:e.touched.repeatPassword&&!!e.errors.repeatPassword,helperText:e.touched.repeatPassword&&e.errors.repeatPassword,fullWidth:!0,...o}),r.jsx(T,{variant:"contained",fullWidth:!0,type:"submit",children:h}),r.jsxs(u,{fontSize:"1rem",children:[c," ",r.jsx(b,{to:w,children:p})]})]})},A=k().shape({firstName:d().min(2,"Za krótkie imię"),lastName:d().min(2,"Za krótkie nazwisko"),email:d().email("Nieprawidłowy adres email"),oldPassword:d().min(8,"Min 8 znaków"),newPassword:d().min(8,"Min 8 znaków"),repeatPassword:d().oneOf([v("newPassword")],"Hasła nie pasują")}),x="https://ontrackbackendapi2.azurewebsites.net/api",E=()=>{const{user:a,isLoggedIn:m,token:n}=g(),[h,i]=j.useState(null);if(!m)return r.jsx("div",{children:"Please log in to edit your settings."});const c=async(t,o)=>{try{const s=await f.put(`${x}/user/me`,{firstName:t,lastName:o},{headers:{Authorization:`Bearer ${n}`}});console.log("User name updated:",s.data)}catch(s){let e="Failed to update user name: ";s instanceof Error&&(e=s.message),console.error(e)}},p=async t=>{try{i(null);const o={};if(t.email&&t.email!==(a==null?void 0:a.email)&&(o.newEmail=t.email),t.newPassword&&t.oldPassword&&(o.newPassword=t.newPassword,o.oldPassword=t.oldPassword),Object.keys(o).length===0)return;const s=await f.post(`${x}/identity/manage/info`,o,{headers:{Authorization:`Bearer ${n}`}});console.log("User email and/or password updated:",s.data)}catch(o){let s="Nie udało się zaktualizować hasła: ";if(o instanceof Error){const e=o;e.response&&e.response.status===400?s="Stare hasło jest nieprawidłowe.":s=e.message}else s="An unknown error occurred.";i(s),console.error(s)}},w=t=>{(t.firstName!==(a==null?void 0:a.firstName)||t.lastName!==(a==null?void 0:a.lastName))&&c(t.firstName,t.lastName),(t.email!==(a==null?void 0:a.email)||t.oldPassword&&t.newPassword)&&p(t)};return r.jsx($,{initialValues:{firstName:(a==null?void 0:a.firstName)??"",lastName:(a==null?void 0:a.lastName)??"",email:(a==null?void 0:a.email)??"",oldPassword:"",newPassword:"",repeatPassword:""},onSubmit:w,formTitle:"Moje ustawienia",submitButtonText:"Zapisz zmiany",userProfile:{name:`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`,avatar:(a==null?void 0:a.avatar)??""},validationSchema:A,apiError:h,passwordFieldProps:{InputLabelProps:{shrink:!0}}})},V=()=>r.jsx("div",{children:r.jsx(z,{children:r.jsx(E,{})})});export{V as default};
