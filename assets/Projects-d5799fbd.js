import{j as e,B as b,C as A,i as T,r as c,q as R,k as _,p as L}from"./index-f2c8bc83.js";import{A as O,M as q}from"./MainLayout-1002bd00.js";import{u as w,B as V}from"./ProjectStore-fa9cd6af.js";import{S as E,I as G,d as U,a as z,u as H,G as Q,C as Y,M as Z,b as J,D as K,O as X,c as ee,A as te,N as se}from"./NoContent-e645a49c.js";import{T as g}from"./Button-505ed133.js";import{D as ne,C as ae,a as ie}from"./CloseButton-59e5aa7a.js";import{u as oe}from"./formik.esm-d0bdd94f.js";import{r as re,i as le,I as N}from"./createSvgIcon-bd9f8e43.js";import{D as de}from"./DialogTitle-d7362f3b.js";import{G as r}from"./Grid-4c54851f.js";import{u as ce}from"./Logo-1d743ff1.js";import{u as ue}from"./useMediaQuery-ca707d98.js";const me="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",xe=({value:s,size:u=100,...a})=>e.jsxs(b,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(A,{variant:"determinate",value:100,size:u,sx:{color:"#5E5F7D",...a.sx}}),e.jsx(A,{variant:"determinate",value:s,size:u,sx:{position:"absolute",left:0,...a.sx}}),e.jsx(b,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(s)}%`})})]});var F={},he=le;Object.defineProperty(F,"__esModule",{value:!0});var W=F.default=void 0,pe=he(re()),fe=e,ge=(0,pe.default)((0,fe.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");W=F.default=ge;const je="https://ontrackbackendapi2.azurewebsites.net/api";function $({isOpen:s,handleClose:u,project:a,mode:p}){var S;const{addProject:j,updateProject:v}=w(),{user:l,token:C}=T(),[k,f]=c.useState(""),[y,m]=c.useState([]),[d,o]=c.useState(((S=a==null?void 0:a.memberIds)==null?void 0:S.map(t=>({id:t})))??[{id:(l==null?void 0:l.id)??""}]),I=async t=>{const i=t.target.value;if(f(i),i)try{const n=await R.get(`${je}/user/search/${i}`,{headers:{Authorization:`Bearer ${C}`}});m(n.data)}catch(n){console.error("Error fetching members:",n)}else m([])},D=t=>{if(!d.find(i=>i.id===t.id)){const i=[...d,t];o(i),x.setFieldValue("memberIds",i.map(n=>n.id))}},B=t=>{const i=d.filter(n=>n.id!==t);o(i),x.setFieldValue("memberIds",i.map(n=>n.id))},x=oe({initialValues:{title:(a==null?void 0:a.title)??"",description:(a==null?void 0:a.description)??"",memberIds:d.map(t=>t.id)},onSubmit:async(t,{setSubmitting:i,resetForm:n})=>{const M={...a,title:t.title,description:t.description,memberIds:t.memberIds};console.log("Submitting data:",M);try{p==="add"?(await j({...M,memberIds:d.filter(h=>h.id!==void 0).map(h=>h.id)}),console.log("Adding project:",M)):p==="edit"&&(a!=null&&a.id)&&(await v(a.id,{...M,memberIds:d.filter(h=>h.id!==void 0).map(h=>h.id)}),console.log("Project updated:",M)),n(),f(""),m([]),o([]),u()}catch(h){console.error("Error submitting the project:",h)}finally{i(!1)}},enableReinitialize:!0}),P=()=>{x.resetForm(),f(""),m([]),o([]),u()};return e.jsxs(ne,{fullWidth:!0,maxWidth:"md",open:s,onClose:P,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(de,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:p==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(ae,{onClick:P,right:20,top:20}),e.jsxs("form",{onSubmit:x.handleSubmit,children:[e.jsxs(ie,{sx:{paddingBottom:12},children:[e.jsx(g,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(E,{fullWidth:!0,variant:"filled",name:"title",value:x.values.title,onChange:x.handleChange,placeholder:"Wpisz nazwe projektu",sx:{width:300}}),e.jsx(g,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(E,{fullWidth:!0,variant:"filled",placeholder:"Wyszukaj członków",value:k,onChange:I,endAdornment:e.jsx(G,{position:"end",children:e.jsx(U,{})})}),k&&y.map(t=>e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,mt:2,borderRadius:"5px",transition:"background-color 0.4s ease-in-out",":hover":{cursor:"pointer",backgroundColor:"#f0f0f0"}},onClick:()=>D(t),children:[e.jsx(O,{alt:`${t.firstName} ${t.lastName}`}),e.jsxs(g,{children:[t.firstName," ",t.lastName]})]},t.id)),e.jsx(b,{mt:4,children:d.map(t=>e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[e.jsx(O,{alt:`${t.firstName} ${t.lastName}`}),e.jsxs(g,{children:[t.firstName," ",t.lastName]}),e.jsx(N,{onClick:()=>B(t.id??""),children:e.jsx(W,{})})]},t.id))})]}),e.jsxs(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(z,{type:"submit",variant:"contained",sx:{marginRight:2},children:"Zapisz"}),e.jsx(z,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:P,children:"Anuluj"})]})]})]})}const be=({project:s,isEditClicked:u})=>{var i;const a=_(),{projectProgress:p}=w(),j=s.id&&p[s.id]||0,[v,l]=c.useState(!1),[C,k]=c.useState(null),[f,y]=c.useState(!1),{requestDelete:m,confirmDelete:d,isConfirmOpen:o,closeModal:I}=H(),D=((i=s==null?void 0:s.taskIds)==null?void 0:i.length)??0,B=n=>{n.stopPropagation(),k(n.currentTarget),l(!0)},x=c.useCallback(n=>{n.stopPropagation(),l(!1),s&&m({id:s.id,type:"project"},w.getState().deleteProject)},[s,m]),P=c.useCallback(n=>{n.stopPropagation(),l(!1),y(!0)},[]),S=()=>{y(!1)},t=()=>{a(`/projects/${s==null?void 0:s.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{onClick:t,sx:{width:"400px",position:"relative"},children:[e.jsx(N,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:n=>{n.stopPropagation(),u?x(n):B(n)},children:u?e.jsx("img",{src:Y,alt:"Usuń"}):e.jsx("img",{src:Z,alt:"Więcej opcji"})}),e.jsxs(r,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(r,{item:!0,xs:7,children:[e.jsx(r,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(g,{children:s==null?void 0:s.title})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(J,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(r,{item:!0,xs:!0,children:(s==null?void 0:s.dueDate)&&e.jsx(K,{date:s.dueDate})})})]}),e.jsxs(r,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(r,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(xe,{value:j})}),e.jsxs(r,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:me,alt:"Tasks"}),e.jsx(g,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${D??0} ${D===1?"zadanie":"zadań"}`})]})]}),e.jsx(r,{})]}),e.jsx(X,{open:v,anchorEl:C,onClose:()=>l(!1),onEdit:n=>P(n),onDelete:x}),e.jsx(ee,{isOpen:o,onDeleteConfirm:d,onClose:I,itemName:s==null?void 0:s.title,itemType:"project"})]}),e.jsx($,{isOpen:f,handleClose:S,project:s,mode:"edit"})]})};function Ce(){const[s,u]=c.useState(!1),[a,p]=c.useState(!1),j=ce(),v=ue(j.breakpoints.down("md")),{projects:l,fetchUserProjects:C,loading:k,error:f}=w();console.log("User projects:",l),c.useEffect(()=>{C()},[C]);const y=o=>{o.stopPropagation(),u(I=>!I),console.log("Edit action triggered")};function m(){p(!1)}const d=o=>{o.stopPropagation(),p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(r,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(r,{item:!0,children:e.jsx(V,{leftButtonLabel:"Projekty",rightButtonLabel:"Wykres",leftButtonLink:"/projects",rightButtonLink:"/wykres"})}),e.jsx(te,{handleAdd:d,handleEditAll:y,children:"Projekt"})]}),k?e.jsx(L,{}):f?e.jsx(b,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(g,{color:"error",children:f})}):l.length===0?e.jsx(se,{type:"project"}):e.jsx(r,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:v?"column":"row",[j.breakpoints.up("md")]:{alignItems:"flex-start"},[j.breakpoints.down("md")]:{alignItems:"center"}},children:l.map(o=>e.jsx(be,{project:o,isEditClicked:s},o.id))}),e.jsx($,{isOpen:a,handleClose:m,mode:"add"})]})}const Oe=()=>e.jsx(e.Fragment,{children:e.jsx(q,{children:e.jsx(Ce,{})})});export{Oe as default};
