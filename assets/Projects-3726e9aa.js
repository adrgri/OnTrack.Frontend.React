import{j as e,B as j,C as D,k as E,r as c,p as A}from"./index-6f106ed5.js";import{M as W}from"./MainLayout-59eb0417.js";import{u as C,B as z}from"./ProjectStore-2ae7a3fd.js";import{S as w,a as B,u as T,G as L,C as N,M as G,b as R,D as $,O as U,c as V,A as q,N as Q}from"./NoContent-74c191c8.js";import{T as f}from"./Button-0c0e6883.js";import{D as Y,C as Z,a as H}from"./CloseButton-c9a5cc35.js";import{u as J}from"./formik.esm-8190c0f0.js";import{D as K}from"./DialogTitle-cd9d46c7.js";import{I as X}from"./createSvgIcon-21aecec0.js";import{G as i}from"./Grid-2503ff3a.js";import{u as _}from"./Logo-81a21063.js";import{u as ee}from"./useMediaQuery-2c7d36d3.js";const te="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",se=({value:t,size:a=100,...s})=>e.jsxs(j,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(D,{variant:"determinate",value:100,size:a,sx:{color:"#5E5F7D",...s.sx}}),e.jsx(D,{variant:"determinate",value:t,size:a,sx:{position:"absolute",left:0,...s.sx}}),e.jsx(j,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(f,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(t)}%`})})]});function v({isOpen:t,handleClose:a,project:s,mode:l}){const{addProject:u,updateProject:g}=C(),n=J({initialValues:{title:(s==null?void 0:s.title)??"",description:(s==null?void 0:s.description)??"",memberIds:["04c662ad-366c-418e-8119-35ec53d68305"]},onSubmit:async(x,{setSubmitting:h})=>{const r={...s,title:x.title,description:x.description,memberIds:["04c662ad-366c-418e-8119-35ec53d68305"]};try{l==="add"?(await u(r),console.log("Adding project:",r)):l==="edit"&&(s!=null&&s.id)&&(console.log("Project updated:",r),await g(s.id,r)),a()}catch(p){console.error("Error submitting the project:",p)}finally{h(!1)}},enableReinitialize:!0}),m=()=>{n.resetForm(),a()};return e.jsxs(Y,{fullWidth:!0,maxWidth:"md",open:t,onClose:a,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(K,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:l==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(Z,{onClick:m,right:20,top:20}),e.jsxs("form",{onSubmit:n.handleSubmit,children:[e.jsxs(H,{sx:{paddingBottom:12},children:[e.jsx(f,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(w,{fullWidth:!0,variant:"filled",name:"title",value:n.values.title,onChange:n.handleChange,placeholder:"Wpisz nazwe projektu",sx:{width:300}}),e.jsx(f,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(w,{fullWidth:!0,variant:"filled",name:"memberIds",value:n.values.memberIds,onChange:n.handleChange,placeholder:"Wyszukaj członków",sx:{width:300}})]}),e.jsxs(j,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(B,{type:"submit",variant:"contained",sx:{marginRight:2},children:"Zapisz"}),e.jsx(B,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:m,children:"Anuluj"})]})]})]})}const ne=({project:t,isEditClicked:a})=>{var I;const s=E(),{projectProgress:l}=C(),u=t.id&&l[t.id]||0,[g,n]=c.useState(!1),[m,x]=c.useState(null),[h,r]=c.useState(!1),{requestDelete:p,confirmDelete:b,isConfirmOpen:d,closeModal:y}=T(),k=((I=t==null?void 0:t.taskIds)==null?void 0:I.length)??0,F=o=>{o.stopPropagation(),x(o.currentTarget),n(!0)},P=c.useCallback(o=>{o.stopPropagation(),n(!1),t&&p({id:t.id,type:"project"},C.getState().deleteProject)},[t,p]),O=c.useCallback(o=>{o.stopPropagation(),n(!1),r(!0)},[]),S=()=>{r(!1)},M=()=>{s(`/projects/${t==null?void 0:t.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(L,{onClick:M,sx:{width:"400px",position:"relative"},children:[e.jsx(X,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:o=>{o.stopPropagation(),a?P(o):F(o)},children:a?e.jsx("img",{src:N,alt:"Usuń"}):e.jsx("img",{src:G,alt:"Więcej opcji"})}),e.jsxs(i,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(i,{item:!0,xs:7,children:[e.jsx(i,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(f,{children:t==null?void 0:t.title})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(R,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(i,{item:!0,xs:!0,children:(t==null?void 0:t.dueDate)&&e.jsx($,{date:t.dueDate})})})]}),e.jsxs(i,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(i,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(se,{value:u})}),e.jsxs(i,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:te,alt:"Tasks"}),e.jsx(f,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${k??0} ${k===1?"zadanie":"zadań"}`})]})]}),e.jsx(i,{})]}),e.jsx(U,{open:g,anchorEl:m,onClose:()=>n(!1),onEdit:o=>O(o),onDelete:P}),e.jsx(V,{isOpen:d,onDeleteConfirm:b,onClose:y,itemName:t==null?void 0:t.title,itemType:"project"})]}),e.jsx(v,{isOpen:h,handleClose:S,project:t,mode:"edit"})]})};function ie(){const[t,a]=c.useState(!1),[s,l]=c.useState(!1),u=_(),g=ee(u.breakpoints.down("md")),{projects:n,fetchUserProjects:m,loading:x,error:h}=C();console.log("User projects:",n),c.useEffect(()=>{m()},[m]);const r=d=>{d.stopPropagation(),a(y=>!y),console.log("Edit action triggered")};function p(){l(!1)}const b=d=>{d.stopPropagation(),l(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(i,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(i,{item:!0,children:e.jsx(z,{leftButtonLabel:"Projekty",rightButtonLabel:"Wykres",leftButtonLink:"/projects",rightButtonLink:"/wykres"})}),e.jsx(q,{handleAdd:b,handleEditAll:r,children:"Projekt"})]}),x?e.jsx(A,{}):h?e.jsx(j,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(f,{color:"error",children:h})}):n.length===0?e.jsx(Q,{type:"project"}):e.jsx(i,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:g?"column":"row",[u.breakpoints.up("md")]:{alignItems:"flex-start"},[u.breakpoints.down("md")]:{alignItems:"center"}},children:n.map(d=>e.jsx(ne,{project:d,isEditClicked:t},d.id))}),e.jsx(v,{isOpen:s,handleClose:p,mode:"add"})]})}const ge=()=>e.jsx(e.Fragment,{children:e.jsx(W,{children:e.jsx(ie,{})})});export{ge as default};
