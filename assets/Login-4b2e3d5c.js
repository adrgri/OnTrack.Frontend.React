import{g as I,a as _,b as S,c as U,s as T,d as F,_ as f,r as m,u as K,e as J,j as s,f as X,h as G,i as w,k as Q}from"./index-ace63820.js";import{S as Y,a as ee}from"./StyledLink-cbef06ce.js";import{u as y,M as c}from"./formik.esm-5da2c63d.js";import{c as j,a as u,b as oe}from"./index.esm-dbebe921.js";import{T as h,u as se,a as re,B as C,L as ae}from"./Logo-f0d95306.js";import{D as te,C as D,a as E}from"./CloseButton-3039b10e.js";import{D as M}from"./DialogTitle-61ad983f.js";import{D as R}from"./DialogActions-925d1f5d.js";import"./IconButton-3d8c7b71.js";function ne(a){return _("MuiLink",a)}const ie=I("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),le=ie,W={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},de=a=>W[a]||a,ce=({theme:a,ownerState:r})=>{const t=de(r.color),n=S(a,`palette.${t}`,!1)||r.color,e=S(a,`palette.${t}Channel`);return"vars"in a&&e?`rgba(${e} / 0.4)`:U(n,.4)},ue=ce,me=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],pe=a=>{const{classes:r,component:t,focusVisible:n,underline:e}=a,o={root:["root",`underline${F(e)}`,t==="button"&&"button",n&&"focusVisible"]};return G(o,ne,r)},he=T(h,{name:"MuiLink",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:t}=a;return[r.root,r[`underline${F(t.underline)}`],t.component==="button"&&r.button]}})(({theme:a,ownerState:r})=>f({},r.underline==="none"&&{textDecoration:"none"},r.underline==="hover"&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},r.underline==="always"&&f({textDecoration:"underline"},r.color!=="inherit"&&{textDecorationColor:ue({theme:a,ownerState:r})},{"&:hover":{textDecorationColor:"inherit"}}),r.component==="button"&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${le.focusVisible}`]:{outline:"auto"}})),fe=m.forwardRef(function(r,t){const n=K({props:r,name:"MuiLink"}),{className:e,color:o="primary",component:i="a",onBlur:l,onFocus:d,TypographyClasses:g,underline:B="always",variant:b="inherit",sx:x}=n,V=J(n,me),{isFocusVisibleRef:P,onBlur:z,onFocus:$,ref:A}=se(),[N,v]=m.useState(!1),O=re(t,A),Z=p=>{z(p),P.current===!1&&v(!1),l&&l(p)},q=p=>{$(p),P.current===!0&&v(!0),d&&d(p)},k=f({},n,{color:o,component:i,focusVisible:N,underline:B,variant:b}),H=pe(k);return s.jsx(he,f({color:o,className:X(H.root,e),classes:g,component:i,onBlur:Z,onFocus:q,ref:O,ownerState:k,variant:b,sx:[...Object.keys(W).includes(o)?[]:[{color:o}],...Array.isArray(x)?x:[x]]},V))}),we=fe,ge=({onForgotPasswordClick:a})=>{const{login:r,isLoggedIn:t}=w(),n=Q(),e=j({email:u().required("To pole jest wymagane").matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/u,"Nieprawidłowy adres email"),password:u().required("To pole jest wymagane").min(8,"Min 8 znaków")}),o=y({initialValues:{email:"coolcoder2000@gmail.com",password:"Otheridk1."},onSubmit:i=>{r(i),o.resetForm()},validationSchema:e});return m.useEffect(()=>{t&&n("/home")}),s.jsxs(Y,{onSubmit:o.handleSubmit,children:[s.jsx(h,{variant:"h5",align:"center",children:"Jesteś już użytkownikiem?"}),s.jsx(c,{id:"email",name:"email",label:"Email",type:"email",autoComplete:"on",variant:"standard",value:o.values.email,onChange:o.handleChange,error:o.touched.email&&!!o.errors.email,helperText:o.touched.email&&o.errors.email,fullWidth:!0,sx:{mt:3}}),s.jsx(c,{id:"password",name:"password",label:"Hasło",type:"password",autoComplete:"on",variant:"standard",value:o.values.password,onChange:o.handleChange,error:o.touched.password&&!!o.errors.password,helperText:o.touched.password&&o.errors.password,fullWidth:!0,sx:{mb:3}}),a&&s.jsx(h,{alignSelf:"flex-end",children:s.jsx(we,{href:"#",onClick:a,children:"Nie pamiętam hasła"})}),s.jsx(C,{variant:"contained",fullWidth:!0,type:"submit",children:"Zaloguj się"}),s.jsxs(h,{fontSize:"1rem",children:["Nie masz konta? ",s.jsx(ee,{to:"/register",children:"Załóż konto"})]})]})},L=T(te)(({theme:a})=>({"& .MuiDialogContent-root":{paddingInline:"16px",paddingTop:0},"& .MuiDialogActions-root":{justifyContent:"center",paddingInline:"16px"},"& .MuiDialog-paper":{maxWidth:"550px",padding:"20px 60px",[a.breakpoints.down("sm")]:{padding:"10px 6px"}}})),xe=j({forgotPasswordEmail:u().email("Nieprawidłowy adres email").required("Email jest wymagany")}),ye=({isOpen:a,handleClose:r,onResetSuccess:t})=>{const{resetPassword:n}=w(),e=y({initialValues:{forgotPasswordEmail:""},validationSchema:xe,onSubmit:async(o,{setSubmitting:i})=>{i(!0);try{await n(o.forgotPasswordEmail),console.log(o.forgotPasswordEmail),console.log("Password reset email sent to",o.forgotPasswordEmail),r(),t(o.forgotPasswordEmail)}catch(l){console.error("Failed to send password reset email",l)}finally{i(!1)}}});return s.jsx("div",{children:s.jsxs(L,{fullWidth:!0,maxWidth:"sm",open:a,onClose:r,children:[s.jsxs(M,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Zapomniałem hasła",s.jsx(D,{onClick:r})]}),s.jsxs("form",{onSubmit:e.handleSubmit,children:[s.jsx(E,{children:s.jsx(c,{autoFocus:!0,margin:"dense",id:"forgotPasswordEmail",label:"Email",type:"email",fullWidth:!0,variant:"standard",value:e.values.forgotPasswordEmail,onChange:e.handleChange,error:e.touched.forgotPasswordEmail&&!!e.errors.forgotPasswordEmail,helperText:e.touched.forgotPasswordEmail&&e.errors.forgotPasswordEmail})}),s.jsx(R,{children:s.jsx(C,{variant:"contained",sx:{textAlign:"center"},type:"submit",fullWidth:!0,children:"Wyślij"})})]})]})})},je=j({resetCode:u().required("Kod resetujący jest wymagany"),newPassword:u().min(8,"Hasło musi zawierać co najmniej 8 znaków").required("Nowe hasło jest wymagane"),repeatPassword:u().oneOf([oe("newPassword")],"Hasła nie pasują").required("Powtożenie hasła jest wymagane")}),Ce=({isOpen:a,handleClose:r,onResetSuccess:t})=>{const{changePassword:n}=w(),e=y({initialValues:{resetCode:"",newPassword:"",repeatPassword:""},validationSchema:je,onSubmit:async(o,{setSubmitting:i})=>{i(!0);try{await n(o.resetCode,o.newPassword,o.repeatPassword),console.log("Password has been reset successfully"),r(),t(o.resetCode)}catch(l){console.error("Failed to reset password",l)}finally{i(!1)}}});return m.useEffect(()=>{a&&navigator.clipboard.readText().then(o=>{o&&o.length===6&&e.setFieldValue("resetCode",o)}).catch(o=>console.error("Failed to read clipboard contents",o))},[a,e]),s.jsxs(L,{fullWidth:!0,maxWidth:"sm",open:a,onClose:r,children:[s.jsxs(M,{sx:{m:0,p:2,fontSize:"1.2rem"},children:["Resetowanie hasła",s.jsx(D,{onClick:r})]}),s.jsxs("form",{onSubmit:e.handleSubmit,children:[s.jsxs(E,{children:[s.jsx(c,{margin:"dense",id:"resetCode",label:"Kod resetujący",type:"text",fullWidth:!0,variant:"standard",value:e.values.resetCode,onChange:e.handleChange,error:e.touched.resetCode&&!!e.errors.resetCode,helperText:e.touched.resetCode&&e.errors.resetCode}),s.jsx(c,{margin:"dense",id:"newPassword",label:"Nowe hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.newPassword,onChange:e.handleChange,error:e.touched.newPassword&&!!e.errors.newPassword,helperText:e.touched.newPassword&&e.errors.newPassword}),s.jsx(c,{margin:"dense",id:"repeatPassword",label:"Powtórz hasło",type:"password",fullWidth:!0,variant:"standard",value:e.values.repeatPassword,onChange:e.handleChange,error:e.touched.repeatPassword&&!!e.errors.repeatPassword,helperText:e.touched.repeatPassword&&e.errors.repeatPassword})]}),s.jsx(R,{children:s.jsx(C,{variant:"contained",type:"submit",fullWidth:!0,children:"Zresetuj hasło"})})]})]})},Me=()=>{const[a,r]=m.useState(!1),{resetPassword:t}=w(),[n,e]=m.useState(!1),o=()=>r(!0),i=()=>r(!1),l=async d=>{try{await t(d),r(!1),e(!0)}catch(g){console.error("Reset password failed:",g)}};return s.jsxs("div",{style:{position:"relative",maxHeight:"100%",height:"100vh"},children:[s.jsx("img",{src:ae,alt:"OnTrack Logo",style:{position:"absolute",top:"50px",width:"240px",left:"50%",transform:"translateX(-50%)"}}),s.jsx(ge,{onForgotPasswordClick:o}),s.jsx(ye,{isOpen:a,handleClose:i,onResetSuccess:d=>{console.log("Reset email sent to:",d),e(!0)}}),s.jsx(Ce,{isOpen:n,handleClose:()=>e(!1),onResetSuccess:l})]})};export{Me as default};
