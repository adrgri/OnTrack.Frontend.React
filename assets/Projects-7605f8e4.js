import{j as e,B as p,C as w,i as U,r,q,k as _,p as H}from"./index-1785b6ff.js";import{A as R,M as Q}from"./MainLayout-354599bd.js";import{u as W,B as J}from"./ProjectStore-29edafc5.js";import{u as K,S as V,I as X,d as ee,a as G,b as te,G as se,C as ne,M as ie,c as ae,e as re,D as oe,O as le,f as de,A as ce,N as ue}from"./NoContent-a18b9e5e.js";import{T as u}from"./Button-123d9d5f.js";import{D as me,C as xe,a as he,d as fe}from"./CloseButton-e0a5b37c.js";import{c as pe,a as ge,u as je}from"./index.esm-2dc4e779.js";import{D as be}from"./DialogTitle-f91adc1c.js";import{I as Z}from"./createSvgIcon-723a9021.js";import{G as l}from"./Grid-f40d980b.js";import{u as ye}from"./Logo-e206157c.js";import{u as ke}from"./useMediaQuery-c15b920d.js";const Ce="/OnTrack.Frontend.React/assets/TasksIcon-00eb2292.svg",Ie=({value:t,size:g=100,...n})=>e.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(w,{variant:"determinate",value:100,size:g,sx:{color:"#5E5F7D",...n.sx}}),e.jsx(w,{variant:"determinate",value:t,size:g,sx:{position:"absolute",left:0,...n.sx}}),e.jsx(p,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(u,{variant:"caption",component:"div",color:"primary.main",fontSize:"1.75rem",children:`${Math.round(t)}%`})})]}),Me="https://ontrackbackendapi2.azurewebsites.net/api",ve=pe({title:ge().trim().min(1,"Tytuł projektu musi zawierać co najmniej 1 znak.").required("Tytuł projektu jest wymagany.")});function Y({isOpen:t,handleClose:g,project:n,mode:m}){var N,z,a,A;const{addProject:y,updateProject:P}=W(),{user:d,token:k}=U(),[i,o]=r.useState([]),[C,b]=r.useState(null),[B,x]=r.useState(!1),[I,D]=r.useState(!1),{searchMemberRef:M,members:$,isLoadingMembers:v,handleSearchChange:E,clearSearchInput:S}=K(!0,i);r.useEffect(()=>{t&&(async()=>{var c;if(x(!0),m==="edit"&&((c=n==null?void 0:n.memberIds)!=null&&c.length))try{const f=await q.get(`${Me}/user/by/ids/${n.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${k}`}});o(f.data)}catch(f){console.error("Error fetching project members:",f)}else o([]);x(!1)})()},[t,m,n,k]);const L=s=>{if(!i.find(c=>c.id===s.id)){const c=[...i,s];o(c),h.setFieldValue("memberIds",c.map(f=>f.id)),S()}},O=s=>{if(i.length===1){b("Projekt musi mieć co najmniej jednego członka.");return}const c=i.filter(f=>f.id!==s);o(c),h.setFieldValue("memberIds",c.map(f=>f.id))},h=je({initialValues:{title:(n==null?void 0:n.title)??"",description:(n==null?void 0:n.description)??"",memberIds:m==="edit"?i.map(s=>s.id):[]},validationSchema:ve,onSubmit:async(s,{setSubmitting:c,resetForm:f})=>{D(!0);const T={...n,title:s.title,description:s.description,memberIds:s.memberIds};try{m==="add"?await y({...T,memberIds:i.filter(j=>j.id!==void 0).map(j=>j.id)}):m==="edit"&&(n!=null&&n.id)&&await P(n.id,{...T,memberIds:i.filter(j=>j.id!==void 0).map(j=>j.id)}),f(),S(),o([]),b(null),g()}catch(j){console.error("Error submitting the project:",j)}finally{c(!1),D(!1)}},enableReinitialize:!0}),F=()=>{h.resetForm(),S(),o([]),b(null),g()};return e.jsxs(me,{fullWidth:!0,maxWidth:"md",open:t,onClose:F,PaperProps:{sx:{overflowY:"auto",maxWidth:"500px"}},children:[e.jsx(be,{sx:{textAlign:"center",fontWeight:600,fontSize:"17px",color:"#5F5B5B",mt:2},children:m==="add"?"Dodaj projekt":"Edytuj projekt"}),e.jsx(xe,{onClick:F,right:20,top:20}),e.jsxs("form",{onSubmit:h.handleSubmit,children:[e.jsxs(he,{sx:{paddingBottom:12},children:[e.jsx(u,{variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Nazwa projektu"}),e.jsx(V,{fullWidth:!0,variant:"filled",name:"title",value:h.values.title,onChange:h.handleChange,placeholder:"Wpisz nazwę projektu",sx:{width:{xs:"100%",sm:300}}}),h.touched.title&&h.errors.title?e.jsx(u,{color:"error",variant:"caption",children:h.errors.title}):null,e.jsx(u,{mt:2,variant:"body1",sx:{color:"#5F5B5B",fontWeight:600},children:"Członkowie"}),e.jsx(V,{fullWidth:!0,variant:"filled",placeholder:"Wyszukaj członków",sx:{width:{xs:"100%",sm:300}},inputRef:M,onChange:E,endAdornment:e.jsx(X,{position:"end",children:e.jsx(ee,{})})}),((N=M.current)==null?void 0:N.value)&&$.length===0&&!v&&e.jsx(u,{color:"textSecondary",variant:"body2",children:"Brak wyników"}),((z=M.current)==null?void 0:z.value)&&v&&e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(w,{})}),!((a=M.current)!=null&&a.value)&&v&&e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(w,{})}),!v&&e.jsxs(e.Fragment,{children:[((A=M.current)==null?void 0:A.value)&&$.map(s=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mt:2,borderRadius:"5px",transition:"background-color 0.4s ease-in-out",":hover":{cursor:"pointer",backgroundColor:"#f0f0f0"}},onClick:()=>L(s),children:[e.jsx(R,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(u,{children:[s.firstName," ",s.lastName]})]},s.id)),B?e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(w,{})}):e.jsx(p,{mt:4,sx:{maxHeight:i.length>2?"100px":"auto",overflowY:i.length>2?"scroll":"visible"},children:i.map(s=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[e.jsx(R,{alt:`${s.firstName} ${s.lastName}`}),e.jsxs(u,{children:[s.firstName," ",s.lastName]}),s.id!==(d==null?void 0:d.id)&&e.jsx(Z,{onClick:()=>O(s.id??""),children:e.jsx(fe,{})})]},s.id))})]}),C&&e.jsx(u,{color:"error",variant:"caption",children:C})]}),e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:2,position:"absolute",bottom:36,right:26},children:[e.jsx(G,{type:"submit",variant:"contained",sx:{marginRight:2},disabled:I,children:I?"Zapisywanie...":"Zapisz"}),e.jsx(G,{type:"button",variant:"contained",sx:{backgroundColor:"#5E5F7D"},onClick:F,children:"Anuluj"})]})]})]})}const Se="https://ontrackbackendapi2.azurewebsites.net/api",we=({project:t,isEditClicked:g})=>{var z;const n=_(),{projectProgress:m}=W(),y=t.id&&m[t.id]||0,[P,d]=r.useState(!1),[k,i]=r.useState(null),[o,C]=r.useState(!1),[b,B]=r.useState([]),[x,I]=r.useState(!1),{requestDelete:D,confirmDelete:M,isConfirmOpen:$,closeModal:v}=te(),E=((z=t==null?void 0:t.taskIds)==null?void 0:z.length)??0,{token:S}=U();r.useEffect(()=>{(async()=>{var A;if(I(!0),(A=t==null?void 0:t.memberIds)!=null&&A.length)try{const s=await q.get(`${Se}/user/by/ids/${t.memberIds.join(",")}`,{headers:{Authorization:`Bearer ${S}`}});B(s.data)}catch(s){console.error("Error fetching project members:",s)}I(!1)})()},[t,S]);const L=a=>{a.stopPropagation(),i(a.currentTarget),d(!0)},O=r.useCallback(a=>{a.stopPropagation(),d(!1),t&&D({id:t.id,type:"project"},W.getState().deleteProject)},[t,D]),h=r.useCallback(a=>{a.stopPropagation(),d(!1),C(!0)},[]),F=()=>{C(!1)},N=()=>{n(`/projects/${t==null?void 0:t.id}/tasks`)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{onClick:N,sx:{width:{xs:"100%",sm:"90%",md:"400px"},position:"relative"},children:[e.jsx(Z,{"aria-label":"more options",sx:{position:"absolute",top:8,right:8},onClick:a=>{a.stopPropagation(),g?O(a):L(a)},children:g?e.jsx("img",{src:ne,alt:"Usuń"}):e.jsx("img",{src:ie,alt:"Więcej opcji"})}),e.jsxs(l,{container:!0,direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{item:!0,xs:7,children:[e.jsx(l,{item:!0,xs:12,mb:2,alignItems:"center",children:e.jsx(u,{children:t==null?void 0:t.title})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(ae,{spacing:2,mb:2,sx:{"& > :not(style) ~ :not(style)":{mt:0}},children:x?e.jsx(p,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(w,{})}):b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"subtitle2",color:"text.secondary",children:"Zespół"}),e.jsx(re,{members:b})," "]})})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(l,{item:!0,xs:!0,children:(t==null?void 0:t.dueDate)&&e.jsx(oe,{date:t.dueDate})})})]}),e.jsxs(l,{item:!0,alignItems:"center",justifyContent:"space-between",xs:4,children:[e.jsx(l,{item:!0,xs:!0,container:!0,justifyContent:"center",children:e.jsx(Ie,{value:y})}),e.jsxs(l,{item:!0,xs:12,mt:2,container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx("img",{src:Ce,alt:"Tasks"}),e.jsx(u,{variant:"subtitle2",color:"text.secondary",ml:1,children:`${E??0} ${E===1?"zadanie":"zadań"}`})]})]}),e.jsx(l,{})]}),e.jsx(le,{open:P,anchorEl:k,onClose:()=>d(!1),onEdit:a=>h(a),onDelete:O}),e.jsx(de,{isOpen:$,onDeleteConfirm:M,onClose:v,itemName:t==null?void 0:t.title,itemType:"project"})]}),e.jsx(Y,{isOpen:o,handleClose:F,project:t,mode:"edit"})]})};function Pe(){const[t,g]=r.useState(!1),[n,m]=r.useState(!1),y=ye(),P=ke(y.breakpoints.down("md")),{projects:d,fetchUserProjects:k,loading:i,error:o}=W();r.useEffect(()=>{k()},[k]);const C=x=>{x.stopPropagation(),g(I=>!I)};function b(){m(!1)}const B=x=>{x.stopPropagation(),m(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{container:!0,spacing:2,alignItems:"baseline",justifyContent:"space-between",children:[e.jsx(l,{item:!0,children:e.jsx(J,{leftButtonLabel:"Projekty",rightButtonLabel:"Wykres",leftButtonLink:"/projects",rightButtonLink:"/wykres"})}),e.jsx(ce,{handleAdd:B,handleEditAll:C,children:"Projekt"})]}),i&&e.jsx(H,{}),o&&e.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(u,{color:"error",children:o})}),!i&&!o&&d.length===0&&e.jsx(ue,{type:"project"}),!i&&!o&&d.length>0&&e.jsx(l,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{flexDirection:P?"column":"row",[y.breakpoints.up("md")]:{alignItems:"flex-start"},[y.breakpoints.down("md")]:{alignItems:"center"}},children:d.map(x=>e.jsx(we,{project:x,isEditClicked:t},x.id))}),e.jsx(Y,{isOpen:n,handleClose:b,mode:"add"})]})}const Re=()=>e.jsx(e.Fragment,{children:e.jsx(Q,{children:e.jsx(Pe,{})})});export{Re as default};
